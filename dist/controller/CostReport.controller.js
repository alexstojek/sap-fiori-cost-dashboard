sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,a,n){"use strict";return e.extend("my.fiori.app.controller.CostReport",{onCostCenterChange:function(e){var t=e.getSource();var r=t.getSelectedKeys();var i=this.byId("pspFilter");var o=i.getBinding("items");if(r.length>0){var s=[];r.forEach(function(e){s.push(new a("ID",n.Contains,e))});var l=new a({filters:s,and:false});o.filter(l)}else{o.filter([])}this._applyFilters()},onPSPChange:function(e){var t=e.getSource();var a=t.getSelectedKey();var n=this.byId("costCenterFilter");if(a&&a.length>=6){var i=a.slice(-6);n.setSelectedKeys([i]);r.show("Kostenstelle automatisch gesetzt: "+i)}this._applyFilters()},onSearch:function(e){this._applyFilters(e.getParameter("query"))},onFilterSearch:function(){this._applyFilters()},_applyFilters:function(e){var t=[];var r=this.byId("costCenterFilter");var i=r.getSelectedKeys();if(i&&i.length>0){var o=[];i.forEach(function(e){o.push(new a("ID",n.EQ,e))});t.push(new a({filters:o,and:false}))}var s=this.byId("pspFilter");var l=s.getSelectedKey();if(l){t.push(new a("PSPElement",n.EQ,l))}if(e&&e.length>0){var u=[];u.push(new a("ID",n.Contains,e));u.push(new a("Name",n.Contains,e));u.push(new a("Manager",n.Contains,e));u.push(new a("PSPElement",n.Contains,e));t.push(new a({filters:u,and:false}))}var c=this.byId("costCenterTable");var g=c.getBinding("items");g.filter(t)},onFilterClear:function(){this.byId("costCenterFilter").setSelectedKeys([]);this.byId("pspFilter").setSelectedKey(null);this.byId("statusFilter").setSelectedKey("All");this.byId("searchField").setValue("");this._applyFilters();r.show("Filter zurückgesetzt")},statusState:function(e,t){var r=parseFloat(e);var a=parseFloat(t);if(!r||!a){return"None"}if(a>r){return"Error"}else if(a>r*.9){return"Warning"}else{return"Success"}},utilizationPercent:function(e,t){var r=parseFloat(e);var a=parseFloat(t);if(!r||!a){return 0}var n=a/r*100;return n>100?100:n},utilizationText:function(e,t){var r=parseFloat(e);var a=parseFloat(t);if(!r||!a){return"0%"}var n=a/r*100;return n.toFixed(0)+"%"},varianceAmount:function(e,t){var r=parseFloat(e);var a=parseFloat(t);if(isNaN(r)||isNaN(a)){return""}return(r-a).toFixed(2)},onInit:function(){var e=new Date(2026,0,1);var t=new Date(2026,2,31);var r=this.byId("dateRange");if(r){r.setDateValue(e);r.setSecondDateValue(t);var a=this.getOwnerComponent().getModel("kpi");if(a){a.setProperty("/Filter/StartDate",e);a.setProperty("/Filter/EndDate",t)}this._recalculateData(e,t)}},onDateChange:function(e){var t=e.getSource();var a=t.getDateValue();var n=t.getSecondDateValue();if(a&&n){var i=this.getView().getModel("kpi");i.setProperty("/Filter/StartDate",a);i.setProperty("/Filter/EndDate",n);this._recalculateData(a,n);r.show("Daten für Zeitraum aktualisiert.")}},_recalculateData:function(e,t){var r=this.getView().getModel("kpi")||this.getOwnerComponent().getModel("kpi");if(!r){return}var a=r.getProperty("/TableItems");if(!a)return;var n=e.getMonth();var i=e.getFullYear();var o=t.getMonth();var s=t.getFullYear();a.forEach(function(e){var t=0;var r=0;if(e.MonthlyData){e.MonthlyData.forEach(function(e){if(e.Year>=i&&e.Year<=s){if(e.Month>=n&&e.Month<=o){t+=e.Budget;r+=e.Actuals}}})}e.Budget=t;e.Actuals=r});r.setProperty("/TableItems",a)},onCostCenterPress:function(e){var t=e.getParameter("listItem");var a=t.getBindingContext("kpi");var n=a.getProperty("ID");var i=a.getProperty("Name");var o=this.getOwnerComponent().getRouter();o.navTo("RouteDetail",{CostCenterID:n});r.show("Öffne Details für: "+i)},onInsightPress:function(e){var t=e.getSource().getBindingContext("kpi").getPath();var a=this.getView().getModel("kpi");var n=a.getProperty(t);r.show("Analyzing: "+n.Title+"\nAI Suggestion: "+n.Description)},onDSOPress:function(){r.show("Drill-down to Accounts Receivable...");var e=this.getOwnerComponent().getRouter();e.navTo("RouteDetail",{CostCenterID:"AR"})},onCashPress:function(){r.show("Drill-down to Cash Flow Statement...")},onInvoicePress:function(e){var t=e.getSource().getBindingContext("kpi").getPath();var a=this.getView().getModel("kpi").getProperty(t);r.show("Opening Invoice: "+a.DocumentNumber)},onActionTrigger:function(e){r.show("Action Triggered: Sending Reminder Email...")},onFilterChange:function(e){r.show("Filter Changed: Reloading Dashboard Data...")}})});
//# sourceMappingURL=CostReport.controller.js.map